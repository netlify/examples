---
import { type CollectionEntry, render } from "astro:content";
import { marked } from "marked";
import BlogPost from "../../layouts/BlogPost.astro";
import { getAllPosts } from "../../lib/get-all-posts";

export async function getStaticPaths() {
  const posts = await getAllPosts();
  return posts.map((post) => ({
    params: { slug: post.id },
    props: post,
  }));
}
type Props = CollectionEntry<"blog">;

const post = Astro.props;

// For blob posts, the body is markdown that needs to be converted to HTML
// For collection posts from Astro, we need to render them
let htmlContent = "";
let Content;

if (post.body && typeof post.body === "string") {
  // Blob post - convert markdown to HTML
  htmlContent = await marked(post.body);
} else {
  // Collection post - use Astro's render
  const rendered = await render(post);
  Content = rendered.Content;
}
---

<BlogPost {...post.data}>
  {htmlContent ? <div set:html={htmlContent} /> : <Content />}
</BlogPost>
